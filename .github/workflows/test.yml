name: Test
on: [push, pull_request]

jobs:
  test:
    name: testing on ${{ matrix.os }}
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-16.04, ubuntu-18.04, macOS-10.14]
    steps:
    - name: compile test file
      run: |
        printf "%s\n%s" '#include "stdio.h"' 'main(){puts("hi");}' | gcc -static -xc -ohi -
    - uses: joshuarli/strip-upx-action@devel
# TODO: pass infile, arguments to strip, upx here
# at the moment, i'm not sure if it's possible to call into a github action's docker container to do, for example:
# - name: run strip
#   run: strip --strip-all ./hi
# - name: run upx
#   run: upx -9 ./hi
    - name: test correctness
      run: test "$(./hi)" = hi
